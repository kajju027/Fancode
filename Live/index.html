<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Video Player</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer@1.26.0/dist/DPlayer.min.css">
    <style>
        /* Simple styling to center the player */
        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
        }
        #dplayer {
            width: 100%;
            height: 100%;
            /* Max width for desktop viewing, adjust as needed */
            max-width: 1000px; 
            max-height: 562px; /* For 16:9 aspect ratio */
        }
        /* Ensure player takes up full screen when in fullscreen mode */
        .dplayer-mobile-play-btn,
        .dplayer-paused .dplayer-video-wrap {
            /* Hide the large play button on mobile for a cleaner look if you prefer, 
               but often better to leave it for user experience. */
            /* display: none; */ 
        }
    </style>
</head>
<body>

    <div id="dplayer"></div>

    <script src="https://cdn.jsdelivr.net/npm/dplayer@1.26.0/dist/DPlayer.min.js"></script>
    <script>
        // --- Configuration Variables ---
        const PLAYER_CONTAINER_ID = 'dplayer';
        const URL_PARAM_KEY = 'ios';
        const DEFAULT_QUALITY_LABEL = '360p';

        /**
         * Function to get the video URL from the query parameter.
         * @returns {string | null} The video URL or null if not found.
         */
        function getVideoUrlFromQuery() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(URL_PARAM_KEY);
        }

        /**
         * Main function to initialize the DPlayer.
         */
        function initializePlayer() {
            const videoUrl = getVideoUrlFromQuery();

            if (!videoUrl) {
                // Handle case where URL is missing (e.g., show a message or a blank player)
                console.error(`Missing video URL. Please use the format: ?${URL_PARAM_KEY}=<YOUR_VIDEO_LINK>`);
                document.getElementById(PLAYER_CONTAINER_ID).innerHTML = 
                    '<p style="color:white; text-align:center; padding-top: 50px;">Please provide a video URL using the <strong>?ios=</strong> parameter.</p>';
                return;
            }

            // --- DPlayer Configuration ---
            const dp = new DPlayer({
                container: document.getElementById(PLAYER_CONTAINER_ID),
                autoplay: true,
                live: false, // Set to true if it's a live stream
                theme: '#FADFA3',
                loop: false,
                lang: 'en',
                screenshot: false,
                hotkey: true,
                volume: 0.7,
                mutex: true,
                video: {
                    quality: [
                        // You can add more qualities here if the link supports adaptive streaming (HLS/DASH)
                        // If 'videoUrl' is a direct MP4/MOV, this quality list might not be fully functional
                        // as DPlayer expects different quality sources for each entry.
                        // However, we set up one source with the desired label/default.
                        {
                            name: 'Auto',
                            url: videoUrl,
                            type: 'auto', // DPlayer detects type (e.g., 'hls' if .m3u8, 'normal' if .mp4)
                        },
                        {
                            name: DEFAULT_QUALITY_LABEL,
                            url: videoUrl,
                            type: 'auto',
                            default: true, // Set this as the default quality on load
                        }
                    ],
                    defaultQuality: 1, // Index of the default quality (1 is the '360p' entry above)
                }
            });

            // --- Custom Fullscreen/Landscape Logic ---

            // DPlayer's fullscreen button is usually sufficient, but to attempt 
            // a landscape rotation on mobile, we can listen for the fullscreen event.
            dp.on('fullscreen', () => {
                console.log('Player entered Fullscreen mode.');
                // This line attempts to lock the screen to landscape.
                // It is a modern API and might be restricted by the browser/OS for security.
                // It works best on Progressive Web Apps (PWAs) or in certain mobile browsers.
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape').catch((error) => {
                        console.warn('Could not lock screen orientation:', error);
                        // The player will still be fullscreen, just not guaranteed landscape.
                    });
                } else if (window.orientation !== undefined) {
                    // Fallback for older browsers (less effective)
                    console.log('Using legacy orientation API.');
                }
            });

            dp.on('fullscreen_cancel', () => {
                console.log('Player exited Fullscreen mode.');
                // Attempt to unlock the screen orientation when exiting fullscreen
                if (screen.orientation && screen.orientation.unlock) {
                    screen.orientation.unlock();
                }
            });
        }

        // Initialize the player when the page loads
        document.addEventListener('DOMContentLoaded', initializePlayer);
    </script>

</body>
</html>
