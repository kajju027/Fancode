<!DOCTYPE HTML>
<HTML LANG="EN">
<HEAD>
    <META CHARSET="UTF-8">
    <TITLE>LIVE STREAM PLAYER</TITLE>
    <META NAME="VIEWPORT" CONTENT="WIDTH=DEVICE-WIDTH, INITIAL-SCALE=1.0, MAXIMUM-SCALE=1.0, USER-SCALABLE=NO" />
    <META NAME="REFERRER" CONTENT="NO-REFERRER" />

    <LINK REL="STYLESHEET" HREF="https://cdn.plyr.io/3.7.8/plyr.css" />
    <LINK REL="STYLESHEET" HREF="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <STYLE>
        :ROOT {
            --PLYR-COLOR-MAIN: #FF0055; 
            --POPUP-BG: #0A0A0A;
            --PRIMARY-COLOR: #FF0055;
            --TEXT-LIGHT: #F1F5F9;
        }
        
        HTML, BODY {
            HEIGHT: 100%;
            MARGIN: 0;
            PADDING: 0;
            OVERFLOW: HIDDEN;
            BACKGROUND-COLOR: #000;
            FONT-FAMILY: -APPLE-SYSTEM, BLINKSYSTEMFONT, "SEGOE UI", ROBOTO, OXYGEN, UBUNTU, CANTARELL, "FIRA SANS", "DROID SANS", "HELVETICA NEUE", SANS-SERIF;
            COLOR: WHITE;
            DISPLAY: FLEX;
            ALIGN-ITEMS: CENTER;
            JUSTIFY-CONTENT: CENTER;
        }

        .VIDEO-CONTAINER {
            WIDTH: 100%;
            HEIGHT: 100%;
            POSITION: RELATIVE;
            MAX-WIDTH: 100%; 
            MAX-HEIGHT: 100%;
        }

        .PLYR {
            WIDTH: 100%;
            HEIGHT: 100%;
        }
        
        .LOADING-OVERLAY {
            POSITION: ABSOLUTE;
            INSET: 0;
            BACKGROUND: RGBA(0, 0, 0, 0.95);
            DISPLAY: FLEX;
            FLEX-DIRECTION: COLUMN;
            ALIGN-ITEMS: CENTER;
            JUSTIFY-CONTENT: CENTER;
            Z-INDEX: 10;
            OPACITY: 1;
            TRANSITION: OPACITY 0.3S EASE;
            COLOR: #FFF;
            FONT-SIZE: 1.1REM;
        }

        .LOADING-OVERLAY.HIDDEN {
            OPACITY: 0;
            POINTER-EVENTS: NONE;
        }

        .SPINNER {
            WIDTH: 60PX;
            HEIGHT: 60PX;
            BORDER: 5PX SOLID RGBA(255, 255, 255, 0.2);
            BORDER-TOP-COLOR: VAR(--PLYR-COLOR-MAIN);
            BORDER-RADIUS: 50%;
            ANIMATION: SPIN 0.8S LINEAR INFINITE;
            MARGIN-BOTTOM: 15PX;
        }

        @KEYFRAMES SPIN {
            TO { TRANSFORM: ROTATE(360DEG); }
        }
        
        .ERROR-MESSAGE {
            POSITION: ABSOLUTE;
            TOP: 50%;
            LEFT: 50%;
            TRANSFORM: TRANSLATE(-50%, -50%);
            PADDING: 25PX;
            BACKGROUND-COLOR: RGBA(180, 0, 0, 0.95);
            BORDER-RADIUS: 10PX;
            TEXT-ALIGN: CENTER;
            Z-INDEX: 999;
            COLOR: WHITE;
            FONT-SIZE: 1.2REM;
            BORDER: 2PX SOLID #FFD700;
        }

        .POPUP-BACKDROP {
            POSITION: FIXED; TOP: 0; LEFT: 0; WIDTH: 100%; HEIGHT: 100%;
            BACKGROUND: RGBA(0, 0, 0, 1); Z-INDEX: 11000;
            DISPLAY: FLEX; ALIGN-ITEMS: CENTER; JUSTIFY-CONTENT: CENTER;
            OPACITY: 1;
            TRANSITION: OPACITY 0.5S EASE;
        }
        .POPUP-BACKDROP.HIDDEN { OPACITY: 0; POINTER-EVENTS: NONE; DISPLAY: NONE; }

        .TELEGRAM-POPUP {
            BACKGROUND: VAR(--POPUP-BG); COLOR: VAR(--TEXT-LIGHT); PADDING: 40PX 30PX;
            BORDER-RADIUS: 16PX; BORDER: 2PX SOLID VAR(--PRIMARY-COLOR);
            BOX-SHADOW: 0 0 60PX 15PX RGBA(255, 0, 85, 0.5); Z-INDEX: 12000;
            TEXT-ALIGN: CENTER; WIDTH: 90%; MAX-WIDTH: 420PX;
            POSITION: RELATIVE;
        }
        .TELEGRAM-POPUP H2 { MARGIN-TOP: 0; COLOR: VAR(--PRIMARY-COLOR); FONT-SIZE: 1.8REM; }
        .TELEGRAM-POPUP P { MARGIN-BOTTOM: 20PX; FONT-SIZE: 1.05REM; }
        .TELEGRAM-POPUP BUTTON {
            WIDTH: 100%; PADDING: 15PX; MARGIN-TOP: 15PX; FONT-SIZE: 1.1REM;
            BORDER: NONE; BORDER-RADIUS: 10PX; CURSOR: POINTER; FONT-WEIGHT: 700;
            TRANSITION: ALL 0.3S;
        }
        .TELEGRAM-POPUP .JOIN-BTN { BACKGROUND: VAR(--PRIMARY-COLOR); COLOR: WHITE; }
        .TELEGRAM-POPUP .JOIN-BTN:HOVER { BACKGROUND: #CC0044; TRANSFORM: SCALE(1.02); }
        .TELEGRAM-POPUP .JOINED-BTN { BACKGROUND: #2D2D2D; COLOR: #F1F5F9; BORDER: 1PX SOLID #3A3A3A; }
        .TELEGRAM-POPUP .JOINED-BTN:HOVER { BACKGROUND: #3A3A3A; TRANSFORM: SCALE(1.02); }
    </STYLE>
</HEAD>
<BODY>

<DIV CLASS="POPUP-BACKDROP" ID="POPUPBACKDROP">
    <DIV CLASS="TELEGRAM-POPUP" ID="TELEGRAMPOPUP">
        <H2><I CLASS="FA-BRANDS FA-WHATSAPP"></I> SUPPORT US!</H2>
        <P>JOIN OUR WHATSAPP CHANNEL <STRONG>ùóñùó•ùóúùóñùóûùóòùóß ùó°ùóòùó™ùó¶ ùó£ùó¢ùóúùó°ùóß</STRONG> FOR INSTANT UPDATES AND EXCLUSIVE LINKS.</P>
        <A HREF="https://whatsapp.com/channel/0029VaeylYYBPzjVNomWuZ0T" TARGET="_BLANK" REL="NOOPENER" ID="JOINLINK" STYLE="TEXT-DECORATION: NONE;">
            <BUTTON CLASS="JOIN-BTN">JOIN NOW</BUTTON>
        </A>
        <BUTTON CLASS="JOINED-BTN" ID="ALREADYJOINEDBTN">ALREADY JOINED</BUTTON>
    </DIV>
</DIV>

<DIV CLASS="VIDEO-CONTAINER">
    
    <DIV CLASS="LOADING-OVERLAY" ID="LOADING-OVERLAY">
        <DIV CLASS="SPINNER"></DIV>
        <P>LOADING STREAM... PLEASE WAIT.</P>
    </DIV>

    <VIDEO ID="PLAYER" PLAYSINLINE CONTROLS></VIDEO>
</DIV>

<SCRIPT SRC="https://cdn.jsdelivr.net/npm/hls.js@latest"></SCRIPT>
<SCRIPT SRC="https://cdn.plyr.io/3.7.8/plyr.js"></SCRIPT>

<SCRIPT>
    CONST PLAYER_ID = 'PLAYER';
    CONST URL_PARAM_KEY = 'IOS';
    CONST AUTO_QUALITY = 0;

    CONST PLAYER_ELEMENT = DOCUMENT.GETELEMENTBYID(PLAYER_ID);
    CONST LOADING_OVERLAY = DOCUMENT.GETELEMENTBYID('LOADING-OVERLAY');
    CONST POPUP_BACKDROP = DOCUMENT.GETELEMENTBYID('POPUPBACKDROP');
    CONST TELEGRAM_POPUP = DOCUMENT.GETELEMENTBYID('TELEGRAMPOPUP');
    CONST JOIN_LINK = DOCUMENT.GETELEMENTBYID('JOINLINK');
    CONST ALREADY_JOINED_BTN = DOCUMENT.GETELEMENTBYID('ALREADYJOINEDBTN');
    
    LET HLS_INSTANCE = NULL;
    LET PLYR_INSTANCE = NULL;
    LET PLAYER_CONFIG = NULL;

    LET PLAYER_INITIALIZED = FALSE;

    FUNCTION DISPLAY_ERROR(MESSAGE) {
        LOADING_OVERLAY.CLASSLIST.ADD('HIDDEN');
        POPUP_BACKDROP.CLASSLIST.ADD('HIDDEN');
        CONST CONTAINER = DOCUMENT.QUERYSELECTOR('.VIDEO-CONTAINER');
        IF (DOCUMENT.QUERYSELECTOR('.ERROR-MESSAGE')) RETURN;
        CONTAINER.INNERHTML += `<DIV CLASS="ERROR-MESSAGE"><H2 STYLE="FONT-WEIGHT: BOLD; MARGIN-BOTTOM: 10PX;">STREAM ERROR</H2><P>${MESSAGE}</P></DIV>`;
        IF (PLYR_INSTANCE) PLYR_INSTANCE.DESTROY();
    }

    FUNCTION GET_VIDEO_URL_FROM_QUERY() {
        CONST URL_PARAMS = NEW URLSEARCHPARAMS(WINDOW.LOCATION.SEARCH);
        CONST VIDEO_URL = URL_PARAMS.GET(URL_PARAM_KEY);
        RETURN VIDEO_URL ? DECODEURICOMPONENT(VIDEO_URL) : NULL;
    }

    FUNCTION ATTACH_PLYR_EVENTS() {
        IF (!PLYR_INSTANCE) RETURN;

        PLYR_INSTANCE.ON('PLAYING', () => LOADING_OVERLAY.CLASSLIST.ADD('HIDDEN'));
        PLYR_INSTANCE.ON('WAITING', () => LOADING_OVERLAY.CLASSLIST.REMOVE('HIDDEN'));
        PLYR_INSTANCE.ON('CANPLAY', () => LOADING_OVERLAY.CLASSLIST.ADD('HIDDEN'));

        PLYR_INSTANCE.ON('ENTERFULLSCREEN', () => {
            IF (SCREEN.ORIENTATION && SCREEN.ORIENTATION.LOCK) {
                SCREEN.ORIENTATION.LOCK('LANDSCAPE').CATCH(() => {}); 
            }
        });

        PLYR_INSTANCE.ON('EXITFULLSCREEN', () => {
            IF (SCREEN.ORIENTATION && SCREEN.ORIENTATION.UNLOCK) {
                SCREEN.ORIENTATION.UNLOCK();
            }
        });
    }

    FUNCTION INITIALIZE_PLAYER() {
        CONST STREAM_URL = GET_VIDEO_URL_FROM_QUERY();

        IF (!STREAM_URL) {
            DISPLAY_ERROR("MISSING VIDEO URL. USE: <CODE>?IOS=YOUR_M3U8_LINK</CODE>");
            RETURN;
        }

        PLAYER_CONFIG = {
            AUTOPLAY: TRUE,
            PLAYSINLINE: TRUE,
            MUTED: TRUE,
            CONTROLS: ['PLAY-LARGE', 'PLAY', 'PROGRESS', 'CURRENT-TIME', 'MUTE', 'VOLUME', 'SETTINGS', 'PIP', 'FULLSCREEN'],
            SETTINGS: ['QUALITY', 'SPEED', 'CAPTIONS'],
            SPEED: {
                SELECTED: 1,
                OPTIONS: [0.5, 0.75, 1, 1.25, 1.5, 1.75, 2]
            },
        };
        
        IF (STREAM_URL.TOLOWERCASE().INCLUDES('.M3U8') && HLS.ISSUPPORTED()) {
            
            HLS_INSTANCE = NEW HLS({
                CROSSORIGIN: 'ANONYMOUS',
                WITHCREDENTIALS: FALSE,
            });

            HLS_INSTANCE.LOADSOURCE(STREAM_URL);
            HLS_INSTANCE.ATTACHMEDIA(PLAYER_ELEMENT);
            
            HLS_INSTANCE.ON(HLS.EVENTS.MANIFEST_PARSED, FUNCTION (EVENT, DATA) {
                
                CONST QUALITIES = DATA.LEVELS.MAP(L => L.HEIGHT).FILTER(BOOLEAN);
                LET AVAILABLE_QUALITIES = [AUTO_QUALITY, ...NEW SET(QUALITIES)].SORT((A, B) => B - A);
                CONST DEFAULT_QUALITY = AVAILABLE_QUALITIES.FIND(Q => Q === 720) || AUTO_QUALITY; 
                
                PLAYER_CONFIG.QUALITY = {
                    DEFAULT: DEFAULT_QUALITY,
                    OPTIONS: AVAILABLE_QUALITIES,
                    FORCED: TRUE,
                    ONCHANGE: (NEW_QUALITY) => {
                        LOADING_OVERLAY.CLASSLIST.REMOVE('HIDDEN');
                        IF (NEW_QUALITY === AUTO_QUALITY) {
                            HLS_INSTANCE.CURRENTLEVEL = -1;
                        } ELSE {
                            CONST LEVEL_INDEX = HLS_INSTANCE.LEVELS.FINDINDEX(LEVEL => LEVEL.HEIGHT === NEW_QUALITY);
                            IF (LEVEL_INDEX !== -1) {
                                HLS_INSTANCE.CURRENTLEVEL = LEVEL_INDEX;
                            }
                        }
                    },
                };

                IF (PLYR_INSTANCE) {
                    PLYR_INSTANCE.DESTROY();
                }
                PLYR_INSTANCE = NEW PLYR(PLAYER_ELEMENT, PLAYER_CONFIG);
                ATTACH_PLYR_EVENTS();

                HLS_INSTANCE.ON(HLS.EVENTS.LEVEL_SWITCHED, () => LOADING_OVERLAY.CLASSLIST.ADD('HIDDEN'));
                
                PLAYER_ELEMENT.PLAY().CATCH(E => CONSOLE.WARN("AUTOPLAY BLOCKED/FAILED.", E));
            });
            
            HLS_INSTANCE.ON(HLS.EVENTS.ERROR, FUNCTION (EVENT, DATA) {
                IF (DATA.FATAL) {
                    HLS_INSTANCE.DESTROY();
                    DISPLAY_ERROR(`PLAYBACK FAILED: ${DATA.REASON}. PLEASE CHECK THE HLS LINK.`);
                }
            });

        } ELSE {
            PLAYER_ELEMENT.SRC = STREAM_URL;
            PLYR_INSTANCE = NEW PLYR(PLAYER_ELEMENT, PLAYER_CONFIG);
            ATTACH_PLYR_EVENTS();
            
            PLAYER_ELEMENT.ADDEVENTLISTENER('ERROR', (E) => {
                 DISPLAY_ERROR("THE VIDEO LINK FAILED TO LOAD OR THE FORMAT IS UNSUPPORTED.");
            });
            
            PLYR_INSTANCE.PLAY().CATCH(E => CONSOLE.WARN("AUTOPLAY BLOCKED/FAILED.", E));
            LOADING_OVERLAY.CLASSLIST.ADD('HIDDEN');
        }
    }

    FUNCTION CLOSE_POPUP_AND_INITIALIZE_PLAYER() {
        POPUP_BACKDROP.CLASSLIST.ADD('HIDDEN');
        TELEGRAM_POPUP.CLASSLIST.ADD('HIDDEN');
        
        IF (!PLAYER_INITIALIZED) {
            LOADING_OVERLAY.CLASSLIST.REMOVE('HIDDEN');
            INITIALIZE_PLAYER();
            PLAYER_INITIALIZED = TRUE;
        }
    }

    JOIN_LINK.ADDEVENTLISTENER('CLICK', () => { SETTIMEOUT(CLOSE_POPUP_AND_INITIALIZE_PLAYER, 500); });
    ALREADY_JOINED_BTN.ADDEVENTLISTENER('CLICK', CLOSE_POPUP_AND_INITIALIZE_PLAYER);

    DOCUMENT.ADDEVENTLISTENER('DOMLOADEDCONTENT', () => {
        POPUP_BACKDROP.CLASSLIST.REMOVE('HIDDEN');
        LOADING_OVERLAY.CLASSLIST.ADD('HIDDEN');
    });

</SCRIPT>

</BODY>
                </HTML>
                        
