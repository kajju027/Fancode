<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>FAMCODE OFFICIAL PLAYER</title>

<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">

<style>
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
    font-family:sans-serif
}
:root{
    --plyr-color-main:#0078e8;
}
.video-container{
    width:100%;
    height:100%;
}
video{
    width:100%;
    height:100%;
}
#loading{
    position:fixed;
    inset:0;
    background:#000;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:999;
}
.spinner{
    width:40px;
    height:40px;
    border:4px solid #333;
    border-top:4px solid #0078e8;
    border-radius:50%;
    animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
.plyr__menu__container{
    backdrop-filter:blur(12px)
}
</style>
</head>

<body>

<div id="loading"><div class="spinner"></div></div>

<div class="video-container">
    <video id="player" playsinline controls></video>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>

<script>
const video = document.getElementById('player');
const loader = document.getElementById('loading');

function getVideo(){
    const p=new URLSearchParams(location.search);
    return p.get('ios');
}

const source = getVideo();
if(!source){
    loader.innerHTML="<h3>Missing ?ios= link</h3>";
    throw new Error("No video");
}

const player = new Plyr(video,{
    autoplay:true,
    muted:true,
    controls:[
        'play-large','play','current-time','duration',
        'mute','volume','settings','pip','fullscreen'
    ],
    settings:['quality','speed']
});

if(Hls.isSupported() && source.includes('.m3u8')){
    const hls = new Hls({capLevelToPlayerSize:true});
    hls.loadSource(source);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED,(_,data)=>{
        const qualities = data.levels
            .map(l=>l.height)
            .filter((v,i,a)=>a.indexOf(v)===i)
            .sort((a,b)=>b-a);

        player.options.quality={
            default:qualities.includes(360)?360:qualities[qualities.length-1],
            options:qualities,
            forced:true,
            onChange:q=>{
                const i=data.levels.findIndex(l=>l.height===q);
                hls.currentLevel=i;
            }
        };

        player.options.speed={
            selected:1,
            options:[0.5,0.75,1,1.25,1.5,1.75,2]
        };

        player.play();
        loader.style.display="none";
    });

}else{
    video.src=source;
    player.play();
    loader.style.display="none";
}

player.on('playing',()=>loader.style.display="none");
</script>

</body>
</html>
